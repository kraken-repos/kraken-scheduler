apiVersion: v1
kind: Pod
metadata:
  name: "{{ template "name" . }}-jmeter-test"
  annotations:
    "helm.sh/hook": test-success
spec:
  containers:
  - name: {{ template "name" . }}-jmeter-test
    image: {{ index .Values "images" "kraken-scheduler-test" }}
    imagePullPolicy: Always
    env:
      - name: REPO_NAME
        value: {{ template "name" .}}
      - name: COMMIT_ID
        value: {{ index .Values "eureka" "envs" "GIT_COMMIT" | quote }}
      - name: SERVICE_NAME
        value: {{ template "name" .}}
      - name: SERVICE_PORT
        value: "80"
      - name: CI_REPORT_HOST
        value: {{.Values.CI_REPORT_HOST}}
    volumeMounts:

    - name: hana
      mountPath: /etc/secrets/hana

    - name: kafka
      mountPath: /etc/secrets/kafka
      
  volumes:

  - name: hana
    secret:
      secretName: {{ template "fullname" $ }}-hana

  - name: kafka
    secret:
      secretName: {{ template "fullname" $ }}-kafka
  restartPolicy: Never


